---
menuIcon: 📦
title: "**Blockchain - 区块链**"
entries:
- struct
- message_pool
- chainsync
- storage_power_consensus
---

{{< incTocMap "/docs/systems/filecoin_blockchain" 3 >}}


The Filecoin Blockchain is a distributed virtual machine that achieves consensus, processes messages, accounts for storage, and maintains security in the Filecoin Protocol.

Filecoin区块链是一个分布式虚拟机，它在Filecoin协议中实现共识、处理消息、存储帐户和维护安全性

It includes:

它包括：

- A {{<sref message_pool>}} subsystem that nodes use to track and propagate messages related to the storage market throughout a gossip network.
- 一个{{<sref message_pool "消息池">}}子系统, 它在整个闲聊网络节点中用来跟踪和传播与存储市场相关的消息。
- A {{<sref chainsync>}} susbystem that tracks and propagates validated message blocks, assembling them into subchains corresponding to versions of the system state.
- 一个{{<sref chainsync "链同步">}} 子系统，它跟踪和传播经过验证的消息块，将它们组装成与系统状态的版本对应的子链。
- A {{<sref vm>}} subsystem used to interpret and execute messages in order to update system state.
- 一个{{<sref vm "虚拟机">}}子系统用于解释和执行消息以更新系统状态
- A {{<sref state_tree>}} subsystem which manages the creation and maintenance of state trees (the system state) deterministically generated by the vm from a given subchain.
- 一个{{<sref state_tree "状态权">}}子系统用于管理状态树(系统状态)的创建和维护，由vm从给定的子链确定地生成
- A {{<sref storage_power_consensus>}} subsystem which tracks {{<sref storage_mining_subsystem "storage">}} state for a given chain and helps the blockchain system choose subchains to extend and blocks to include in them.
- 一个{{<sref storage_power_consensus "存储权重共识">}}子系统，它跟踪给定链的存储状态，并帮助区块链系统选择要扩展的子链和要包含在其中的块。

At a high-level, the Filecoin blockchain grows through successive rounds of leader election in which a number of miners are elected to generate a block, whose inclusion in the chain will earn them block rewards.

在一个高的级别，Filecoin区块链通过连续几轮的领导人选举来增长，在这轮选举中，一些矿工被选出来产生一个区块，其包含在链中将为他们赢得区块奖励。

Most of the functions of the Filecoin blockchain system are detailed in the code below. We focus here on particular points of interest.

下面的代码详细介绍了Filecoin区块链系统的大部分功能。我们在这里集中讨论一些特殊的兴趣点。

## Storage Power - 存储权重

Filecoin's blockchain runs on storage power. That is, its consensus algorithm by which miners agree on which subchain to mine is predicated on the amount of storage backing that subchain. At a high-level, the {{<sref storage_power_consensus>}} subsystem maintains a _Power Table_ that tracks the amount of storage {{<sref storage_mining_subsystem "storage miner actors">}} have contributed to the network through _Sector commitments_ and _Proofs of Spacetime_.

Filecoin的区块链运行在存储权重上。也就是说，它的一致算法是根据支持该子链的存储量来预测哪个子链适合于挖矿。在高级别次上，{{<sref storage_power_consensus "存储权重共识">}}子系统维护一个 _权重表_ ，通过{{<sref storage_mining_subsystem "存储矿工角色">}}来跟踪 _扇区承诺_ 和 _时空证明_ 向网络贡献的存储量。

## Leader Election and Expected Consensus - 领导人选举与预期共识

The leader election process is likewise handled by the {{<sref storage_power_consensus>}} subsystem (SPC). Using the _Power Table_ it maintains, this subsystem runs a Nakamoto-style leader election process called Expected Consensus at every round to elect miners who can extend the block chain by generating new blocks.

领导人选举过程同样由{{<sref storage_power_consensus "存储权重共识">}} 子系统(SPC)处理。使用它维护的 _权重表_ ，这个子系统运行一个Nakamto风格的领导人选举过程，称为预期共识，在每一轮选举中选出可以通过生成新区块来扩展区块链的矿工。

Beyond participating in the Storage Market (see the {{<sref storage_market>}} spec), participation in Filecoin's consensus is the other way storage miners can earn Filecoin tokens.

除了参与存储市场(参考{{<sref storage_market "存储市场">}}规范)之外，参与Filecoin的共识是存储矿工获得Filecoin令牌的另一种方式。

{{<sref expected_consensus>}} has two main components: a leader election process and a chain selection algorithm dependent on a weight function.
{{<sref expected_consensus "扩展共识">}} 有两个主要组件:一个领导人选举过程和一个基于权重函数的链选择算法。

## Tipsets - 提示设置

EC can elect multiple leaders in a given round meaning Filecoin chains can contain multiple blocks at each height (one per winning miner). This greatly increases chain throughput by allowing blocks to propagate through the network of nodes more efficiently but also means miners should coordinate how they select messages for inclusion in their blocks in order to avoid duplicates and maximize their earnings from transaction fees (see {{<sref message_pool>}}).

EC可以在给定的回合中选择多个领导人，这意味着Filecoin链可以在每个高度包含多个块(每个获胜的矿工一个块)。这极大地提高了链吞吐量，允许块更有效地在节点网络中传播，但也意味着矿商应该协调如何选择要包含在他们的块中的消息，以避免重复和最大化他们的交易费用收入(参见{{<sref message_pool "消息池">}})。

Accordingly, blocks from a given round are assembled into Tipsets according to certain rules (they must share the same parents and have been mined at the same height). The Filecoin state tree is modified by the execution of all messages in a given Tipset. Different miners may mine on different Tipsets because of network propagation delay.

因此，根据特定的规则(它们必须共享相同的父元素，并且在相同的高度被开采)，将来自给定回合的块组装到tipset中。通过执行给定Tipset中的所有消息来修改Filecoin状态树。由于网络传播延迟的原因，不同的采矿者可能在不同的tipset上进行开采。

Due to this fact, adding new blocks to the chain actually validate those blocks' parent Tipsets, that is: executing the messages of a new block, a miner cannot know exactly what state tree this will yield. That state tree is only known once all messages in that block's Tipset have been executed. Accordingly, it is in the next round (and based on the number of blocks mined on a given Tipset) that a miner will be able to choose which state tree to extend.

由于这个事实，向链中添加新块实际上会验证这些块的父tipset，即:执行新块的消息，矿工不能确切地知道这会产生什么状态树。该状态树只有在该块的Tipset中的所有消息都被执行之后才知道。因此，在下一轮中(基于给定Tipset上挖掘的块的数量)，矿工将能够选择扩展哪个状态树。

## Tipsets

All valid blocks generated in a round form a `Tipset` that participants will attempt to mine off of in the subsequent round (see above). Tipsets are valid so long as:

所有有效的区块都以“Tipset”的形式生成，参与者将在接下来的一轮中尝试挖掘这些区块(见上文)。提示集是有效的，只要：

- All blocks in a Tipset have the same parent Tipset
- 一个Tipset中的所有块都具有相同的父Tipset
- All blocks in a Tipset have the same number of tickets in their `Tickets` array
- Tipset中的所有块在它们的`Tickets`数组中都有相同数量的票

These conditions imply that all blocks in a Tipset were mined at the same height. This rule is key to helping ensure that EC converges over time. While multiple new blocks can be mined in a round, subsequent blocks all mine off of a Tipset bringing these blocks together. The second rule means blocks in a Tipset are mined in a same round.

这些条件意味着，Tipset中的所有块都是在相同的高度开采的。这条规则是帮助确保EC随着时间收敛的关键。虽然可以在一轮中开采多个新区块，但是后续的区块都是在一个Tipset上开采的，将这些区块聚集在一起。第二条规则是在同一轮中挖掘Tipset中的块。

The blocks in a tipset have no defined order in representation. During state computation, blocks in a tipset are processed in order of block ticket, breaking ties with the block CID bytes.

tipset中的块没有定义表示顺序。在状态计算期间，按照块票证顺序处理tipset中的块，从而断开与块CID字节的联系。

Due to network propagation delay, it is possible for a miner in round N+1 to omit valid blocks mined at round N from their Tipset. This does not make the newly generated block invalid, it does however reduce its weight and chances of being part of the canonical chain in the protocol as defined by EC's {{<sref chain_selection>}} function.

由于网络传播延迟，在第N+1轮挖掘的矿商可能会从他们的Tipset中忽略在第N轮挖掘的有效块。这并不会使新生成的块无效，但是它确实降低了它的权重，并且降低了成为协议中规范链的一部分的机会，这是由EC的{{<sref chain_selection "链选择">}} 函数定义的。

## TODO -- reorder this - 重排序这

The Filecoin blockchain is the main interface linking various actors in the Filecoin system. It ensures that the system's state is verifiably updated over time and dictates how nodes are meant to extend the network through block reception and validation and extend it through block propagation.

Filecoin区块链是连接Filecoin系统中各个角色的主接口。它确保随着时间的推移，系统的状态得到可验证的更新，并指示节点如何通过块接收和验证扩展网络，以及如何通过块传播扩展网络。

Its components include the:

其组件包括:

- {{ <sref chainsync> }} -- which receives and propagates blocks, maintaining sets of candidate chains on which the miner may mine and running syntactic validation on incoming blocks.
- {{ <sref chainsync "链同步"> }} -- 它接收和传播块，维护候选链集，挖掘器可以在这些候选链集上进行挖掘，并在传入块上运行语法验证。
- {{ <sref chain_manager> }} -- which maintains a given chain's state, providing facilities to other blockchain subsystems which will query state about the latest chain in order to run, and ensuring incoming blocks are semantically validated before inclusion into the chain.
- {{ <sref chain_manager "链管理器"> }} -- 它维护给定链的状态，为其他区块链子系统提供功能，这些子系统将查询关于最新链的状态以便运行，并确保传入块在包含到链之前经过语义验证。
- {{ <sref block_producer> }} -- which is called in the event of a successful leader election in order to produce a new block that will extend the current heaviest chain before forwarding it to the syncer for propagation.
- {{ <sref block_producer "区块生产器"> }} 这是在一个成功的领导人选举事件中调用，以产生一个新的块，它将扩展当前最重的链，然后转发到同步器进行传播。
